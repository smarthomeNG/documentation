=============================
Release 1.10.x - tt. mmm 2024
=============================

Dieses Release ist ein Wartungs-Release. Außer Bugfixes gibt es einige neue Features im Core von SmartHomeNG,
sowie einige neue Plugins.

.. only: comment

    Dieses Release ist ein Feature-Release. Es gibt eine Menge neuer Features im Core von SmartHomeNG und den Plugins.

|

.. only:: develop_branch

    .. note::

        Diese Release Notes sind ein Arbeitsstand.

         - Berücksichtigt sind Commits im smarthome Repository bis incl. 28. Dezember 2024
           (...)
         - Berücksichtigt sind Commits im plugins Repository bis incl. 13. März 2024
           (...)


Überblick
=========

Dieses ist neues Release für SmartHomeNG. Die Änderungen gegenüber dem Release v1.10.0 sind im
folgenden in diesen Release Notes beschrieben.


Minimum Python Version
----------------------

Die absolute Minimum Python Version in der SmartHomeNG startet, ist **Python 3.8**.

Für das SmartHomeNG Release 1.10 wird die absolute Minimum Python Version auf **Python 3.8** angehoben, da der
Community Support für Python 3.7 am 27. Juni 2023 endete.

Bei einer Neuinstallation wird jedoch empfohlen auf einer der neueren Python Versionen (3.9 oder 3.10) aufzusetzen.


Unterstützte Python Versionen
-----------------------------

Die älteste offiziell unterstützte Python Version für SmartHomeNG Release 1.10.x ist **Python 3.8**.
Automatisierte Tests von SmartHomeNG werden nur in den unterstützten Python Versionen durchgeführt.
(Siehe auch :ref:`Hard- u. Software Anforderungen <python_versionen>` im Abschnitt **Installation**
zu unterstützten Python Versionen)

|

Änderungen am Core
==================

Allgmein
--------

* github:

  * Workflows: Fix unittest for forked repos in core
  * Modify gitignore structure



Bugfixes im CORE
----------------

* Fix pathname/conffile access


Updates in the CORE
-------------------

* Move templates for logics and userfucntions to new template dir, adjust api_files
* Replace static file/dir references by constants
* Move to get_config_dir/get_config_file
* Rename templates_dir var
* Add metadata checks for sdp version
* Add pyrightconfig.json to gitignore


* bin

  * smarthome

    * Added option -e (--config_etc)

  * shngversion:

    * Bumped core version to 1.10.0.2 -> added support for asyncio in plugins



* Items:

  * ...

* Logics:

  * ...

* Libs:

  * requirements.txt: Some libs received overhauling and bugs were fixed

  * lib.backup:

      * Added support for option -e (--config_etc)
      * Added the output of 'pip list' to the configuration backup file

  * lib.config:

    * Remove name attribute from struct root before merging
    * Add struct syntax checking

  * lib.db:

    * Handle numeric passwords and OrderedDict lists

  * lib.env:

    * Modified error handling for location_name()
    * Added some logging

  * lib.item:

    * Replace item.path() with item.property.path
    * Added warning for collision of name and class method
    * Speedup name collision check
    * Add methods for list/dict manipulation
    * Remove old list/dict methods
    * Add ancestor item/attr methods
    * Replace return_parent and _get_attribute_value
    * Rename find_attr to find_attribute
    * find_attribute: Return default value
    * Allow log level to be set by eval expression
    * Fader introduce stop_fade, continue_fade, instant_set and update functionality
    * Fader check if stop/continue_fade is list and handle issues
    * on_update and on_change now support special vars 'caller', 'source' and 'dest' in addition to 'value'
    * Fix dynamic log_level
    * Allow for default log text in smarthome.yaml, used by log_change
    * log_mapping and log_rules are now expected to be stated as a list. However, putting a dict as string is still possible (non-breaking)
    * Revert _items_instance.return_item
    * Fader method: fix caching after successful fade
    * Log rules: log warning if invalid parameter is set
    * Remove debug code
    * log_rules: Detailed warnings on wrong configuration, only log the same entry once
    * log_rules: Ignore same low- and highlimit values, only lowlimit counts

  * lib.log:

    * Mutable etc_dir not persited in lib/log.py
    * Log issues with logging.yaml to standard shng logger additionally
    * Allow weekly, monthly and yearly rotation when using DateTimeRotatingFileHandler
    * Fix for bug introduced with v 1.10 in ShngTimedRotatingFileHandler: Log content and file name had an offset
    * custom_replace function: add r in front of regex including \d
    * Add develop level (9) for easier debugging when developing

  * lib.logic:

    * Introduce class-wide logic conf filename

  * lib.model:

    * mqttplugin:

      * Replace item.path() with item.property.path

    * sdp:

      * Improvements
      * Add version, cyclic error detection/reconnect
      * Implement read after write
      * Fix attr resolving
      * Fix long cyclic recovery
      * Several minor fixes/updates
      * Adjust to smartplugin changes
      * suspend/resume
      * Fix missing parameter
      * Move to sdp v1.0.2
      * Pass plugin reference to connection/protocol
      * Change to scheduler_remove_all
      * Modify run logics
      * Propose resend protocol
      * Move command storing
      * Set protocol to resend if send_retries > 0
      * Query current value for command that was not successfully sent
      * Fix and improve read command for querying after resend is not successful
      * Rename check_command to check_reply as this is more suitable
      * Join resend/jsonrpc parameters, cleanup
      * Add minimum version check
      * Make resending work with custom command values
      * Correctly handle reply_patterns defined as lists for resend protocol
      * Parse custom_parameters correctly for reply_pattern used for resend protocol
      * Improve struct generation
      * Add delivery queue to serial connection for better timing
      * Connection.py aktualisieren
      * Fix order of connect initialization, fix struct generation
      * Fix sdp references

    * smartplugin:

      * Replace item.path() with item.property.path
      * Added support for the use of asyncio in plugins
      * Improved error handling in stop_asyncio()
      * run_async_coro can now return the result of the coro to the calling method
      * Added option to run_async_coro to return Exception to the calling method
      * Added method asyncio_state()
      * Implemented _start_known_asyncio_coro()
      * Implemented put_command_to_run_queue() and get_command_from_run_queue()
      * Alternative way to track schedulers
      * Move suspend item to pause item, cleanup
      * Add mqttplugin
      * Fix default _cycle
      * Remove warning if scheduler entry not found

  * lib.network:

    * Add serial connection reset error handling

  * lib.shpypi:

    * Bugfix to prevent plugin requirements from being written to base.txt
    * Calculate versions for requiremens above/below given version
    * Added the output of 'pip list' to the configuration backup file
    * Removed logging from create_pip_list method
    * Fixed bug in installing requirements, when a wrong pip-command was used

  * lib.smarthome:

    * Added support for option -e (--config_etc)
    * Log issues with logging.yaml to standard shng logger additionally
    * Added state print when running in forground mode
    * Catched exception in objects_refcount()
    * **c1**
    * Clean up directory vars
    * Add generic get conffile/confdir method
    * Create necessary dirs
    * Skip deprecation warnings for decrepit ciphers on macOS

  * lib.struct:

    * Add struct syntax checking

  * lib.utils:

    * Added functions to return lists with all local ipv4/ipv6 addresses
    * Removed logging info and changed parameter typing to be compatible with Python 3.9 and under

  * lib.whocalledme:

    * New module to help debugging core and plugin code

* Modules:

  * module.admin:

    * Adjusted a loglevel
    * Display all local ipv4 addresses in systemdata
    * Added option to handle a second webinterface (admin gui)
    * Implemented CORS support in rest.py
    * Addition to /api/server
    * api_config.py updates hashed_password for running instance after password change
    * Added SystemController()
    * Added gui_type for boolean parameters
    * Changed requirements for pyjwt because new version of pyjwt has a breaking change

  * modules.http:

    * Extended base_plugin to support 8 tabs in webinterface
    * Fix issue with datatable when bodytab count changed after cookies have been set
    * Ensure that actual value of password_hash is used for login
    * Added gui_type for boolean parameters
    * Not only update responsive cell when hidden but also when visible

  * modules.mqtt:

    * Changed requirements - the lately released paho client 2.0 has breaking changes
    * Added gui_type for boolean parameters

  * modules.websocket:

    * Added attributes to identity message in smartvisu payload protocol
    * Added gui_type for boolean parameters
    * Added some logging to smartvisu payload protocol
    * Fix for smartvisu protocol
    * Fix item access for smartvisu protocol
    * Requirements: Limit websocket version to prevent error due to incompatible changes in websocket lib with version 13.0
    * Fix smartvisu item monitoring

* Plugins:

  * ...

* tests:

  * Update mock core

* tools:

  * tools/cpuusage:

    * Wait for pid file creation
    * Fix output buffering

|

Änderungen bei Plugins
======================

Allgmein
--------

* Workflows:

  * ...


.. _releasenotes_1_10_x_neue_plugins:

Neue Plugins
------------

Für Details zu den neuen Plugins, bitte die Dokumentation des jeweiligen Plugins unter
http://www.smarthomeng.de/user/plugins_all.html konsultieren.

* <Name>: ...


.. _releasenotes_1_10_x_updates_plugins:

Plugin Updates
--------------

Für Details zu den Änderungen an den einzelnen Plugins, bitte die Dokumentation des jeweiligen Plugins unter
http://www.smarthomeng.de/user/plugins_all.html konsultieren.

* avm:

  * Catch exception after maximum retries exceeded

* database:

  * Corrected inline comment

* db_addon:

  * Fix bug in wachstumsgradtage
  * Fix bug in database queries for "next"-function
  * Fix bug in database queries for "next"-function
  * Fix bug in kaeltesumme
  * Bugfix in wachstumsgradtage and docu update

* enocean:

  * Adapted caller to global smarthomeNG convention -> enocean instead of EnOcean

* homematic:

  * Added name to an unnamed thread
  * Fixed webinterface for items with the same name

* ical:

  * Fix issue when timezone info contains : e.g. "timezone://..."
  * Bump v to 1.6.4

* jsonread:

  * Update docu
  * Update maintainer, tester
  * Remove pyminversion
  * Bump version to 1.0.4

* ksemmodbus:

  * Removed support for pymodbus2

* neato:

  * Removed debug output
  * Added proper backend online status decoding

* nuki:

  * Changes on request lock mechanism
  * Added debug logging
  * Fixed README.md
  * Renamed remotestart_1/2.path to remotestart_1/2.rstart_path
  * Added timeout to request handling against api to prevent unlimited blocks of lock

* robonect:

  * Removed strange / in version number

* rrd:

  * Remove useless webinterface code and folder
  * Fix docu

* shelly:

  * Extended plugin to support generation 3 devices
  * Catch exception in update_item if ID is not known yet
  * Minor typo fixes in documentation
  * Fix docu

* simulation:

  * sv_widget option to avoid block with headline

* sma_mb:

  * Removed support for pymodbus2

* smartvisu:

  * Fix for display of datetime object

* solarforecast:

  * Catch exception if return value is not json conform

* sonos:

  * Minor robustness fix

* stateengine:

  * Fix logging of header when directory is not created yet

* tasmota:

  * Add input button

* uzsu:

  * Fix previously introduced problem with series rrule
  * Improve handling of invalid items
  * Improve logging
  * Bump version to 2.0.1

* vicare:

  * If multiple devices are available, readout the first device with valid boiler serial number
  * Added list of available devices to webinterface

* zigbee2mqtt:

  * Add new structs

* Multiple plugins:

  * Replace item.path() with item.property.path


Outdated Plugins
----------------

Die folgenden Plugins wurden bereits in v1.6 als *deprecated* (veraltet) markiert. Das bedeutet, dass diese
Plugins zwar noch funktionsfähig sind, aber nicht mehr weiter entwickelt werden. Sie werden in einem kommenden
Release von SmartHomeNG entfernt werden. Anwender dieser Plugins sollten auf geeignete Nachfolge-Plugins
wechseln.

* System Plugins

  * backend - use the administration interface instead
  * sqlite_visu2_8 - switch to the **database** plugin

* Web Plugins

  * wunderground - the free API is not provided anymore by Wunderground


Die folgenden Plugins wurden in v1.7 als *deprecated* (veraltet) markiert, weil kein Nutzer oder Tester
dieser Plugins gefunden werden konnte:

* Gateway Plugins

  * ecmd
  * elro
  * iaqstick
  * snom
  * tellstick

* Interface Plugins

  * easymeter
  * smawb
  * vr100

* Web Plugins

  * nma

Weiterhin wurde das bisherige mqtt Plugin zu mqtt1 umbenannt und als *deprecated* markiert, da das neue mqtt
Plugin diese Funktionalität übernimmt. Das neue mqtt Plugin nutzt dazu das mqtt Modul des aktuellen Cores
von SmartHomeNG.


Retired Plugins
---------------

Die folgenden Plugins wurden *retired* (in den RUhestand geschickt). Sie waren in einem der vorangegangenen
Releases von SmartHomeNG als *deprecated* markiert worden. Diese Plugins wurden aus dem **plugins** Repository
entfernt, stehen jedoch als Referenz weiterhin zur Verfügung. Diese Plugins wurden in das **plugin_archive**
Repositiory aufgenommen.

* ...

|

Weitere Änderungen
==================

Tools
-----

* ...


Dokumentation
-------------

* Sample Plugin: Updated with asyncio handling
* Sample plugins: Aet version numbers in quotes
* Sample MQTT Plugin: Fix pause item name
* Update crontab description for items and logics
* Updates for asyncio support for plugins
* Added installation of ESPHome dashboard
* Extended lib.backup to backup and restore ESPHome configurations
* Added info for ESPHome
* Updated/corrected docu on log_text
* Add info on log_level via eval expression
* Fader update docu for new functionality
* Update NGINX Reverse Proxy
* Fix log_change default
* Komplettanleitung smartVISU updated

* Build doc local: make script work on Mac OS X, too
* Build docu: Fallback for locale


